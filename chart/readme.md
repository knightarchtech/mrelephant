# Introduction

This is a [Helm](https://helm.sh/) chart for installing Mastodon into a
Kubernetes cluster.  The basic usage is:

1. edit `values.yaml` or create a separate yaml file for custom values
1. create namespace
  <pre>kubectl create ns mrelephant</pre>
1. create TLS secret
  <pre>/bin/sh ../scripts/create-self-signed-cert.sh mrelephant-tls mrelephant</pre>
1. run helm install
  <pre>
  helm dep update
  helm install \
    --namespace mrelephant \
    --create-namespace mrelephant ./ -f values_mrelephant.yaml
  </pre>
1. reset admin password
  <pre>
  kubectl -n mrelephant exec \
   -it pod/$(kubectl -n mrelephant get pods |grep mastodon-web |awk {'print $1'}) \
   -- tootctl accounts modify mastadmin --reset-password
  </pre>

This chart has been tested on Helm 3.0.1 and above.

# Configuration

The variables that _must_ be configured are:

- password and keys in the `mastodon.secrets`, `postgresql`, and `redis` groups; if
  left blank, some of those values will be autogenerated, but will not persist
  across upgrades.

- SMTP settings for your mailer in the `mastodon.smtp` group.

# Missing features

Currently this chart does _not_ support:

- Hidden services
- Swift

# Upgrading

Because database migrations are managed as a Job separate from the Rails and
Sidekiq deployments, itâ€™s possible they will occur in the wrong order.  After
upgrading Mastodon versions, it may sometimes be necessary to manually delete
the Rails and Sidekiq pods so that they are recreated against the latest
migration.
